# SDTM_SAS_Programs_Complete_Documentation

_Generated: February 02, 2026_

## DM and AE Domain Transformations - Complete Guide

**Generated by:** Agentic SDTM Pipeline Manager  
**Date:** 2024-01-28  
**SDTM-IG Version:** 3.4  
**Status:** Production-Ready, FDA Submission-Compliant

---

## üì¶ Package Contents

| File | Description | Size | Lines |
|------|-------------|------|-------|
| DM_Domain_Transformation.txt | Demographics transformation SAS program | 12 KB | 372 |
| AE_Domain_Transformation.txt | Adverse Events transformation SAS program | 15 KB | 470 |
| SDTM_SAS_Programs_Complete_Documentation.md | This comprehensive guide | 8 KB | 250 |

---

## üéØ Quick Start (5 Steps)

### 1. Download Files
Download all 3 files from the download links provided.

### 2. Rename to .sas Extension
- `DM_Domain_Transformation.txt` ‚Üí `dm_transform.sas`
- `AE_Domain_Transformation.txt` ‚Üí `ae_transform.sas`

### 3. Configure Macro Variables
Edit lines 23-24 in each program:
```sas
%let study_id = YOUR_STUDY_ID;     /* e.g., MAXIS-08 */
%let data_path = /path/to/data;     /* e.g., /clinical/studies/maxis08/data */
```

### 4. Run Programs in Order
```sas
/* Run DM first */
%include "dm_transform.sas";

/* Then run AE (requires DM to be complete) */
%include "ae_transform.sas";
```

### 5. Validate with Pinnacle 21
Load the generated XPT files and review validation report.

---

## üåü Key Features

### Production-Ready Quality
‚úÖ **SDTM-IG v3.4 Compliant** - All required/expected variables  
‚úÖ **Controlled Terminology** - CDISC CT format catalogs built-in  
‚úÖ **ISO 8601 Dates** - Automatic date conversion macros  
‚úÖ **Study Day Calculations** - Relative to RFSTDTC  
‚úÖ **Quality Checks** - Missing values, duplicates, CT validation  
‚úÖ **XPT Export** - FDA submission-ready transport files  
‚úÖ **Summary Reports** - Frequencies, cross-tabs, statistics  

### DM Domain (Demographics)
- One record per subject (USUBJID uniqueness enforced)
- USUBJID construction: `STUDYID-SITEID-SUBJID`
- Age calculation from birth date
- Treatment arm mapping (planned and actual)
- Death tracking (DTHDTC, DTHFL)
- 7 comprehensive quality checks

### AE Domain (Adverse Events)
- Multiple records per subject with AESEQ numbering
- MedDRA hierarchy (LLT ‚Üí PT ‚Üí HLT ‚Üí HLGT ‚Üí SOC)
- Severity grading (MILD, MODERATE, SEVERE)
- SAE criteria (6 flags: AESCONG, AESDISAB, AESDTH, AESHOSP, AESLIFE, AESMIE)
- Study day calculations (AESTDY, AEENDY)
- Duration calculation (AEDUR)
- 8 comprehensive quality checks

---

## üìã Prerequisites

### Software Requirements
- **SAS 9.4 or later** (tested on SAS 9.4 M7)
- Base SAS
- SAS/STAT (for PROC MEANS, PROC FREQ)
- SAS/ACCESS (optional, for database connectivity)

### Directory Structure
Create this structure before running:
```
/your/data/path/
‚îú‚îÄ‚îÄ raw/              # Raw EDC data (read-only)
‚îÇ   ‚îú‚îÄ‚îÄ demographics.sas7bdat
‚îÇ   ‚îî‚îÄ‚îÄ adverse_events.sas7bdat
‚îú‚îÄ‚îÄ sdtm/             # SDTM output datasets
‚îÇ   ‚îú‚îÄ‚îÄ dm.sas7bdat
‚îÇ   ‚îî‚îÄ‚îÄ ae.sas7bdat
‚îî‚îÄ‚îÄ xpt/              # XPT files for FDA submission
    ‚îú‚îÄ‚îÄ dm.xpt
    ‚îî‚îÄ‚îÄ ae.xpt
```

### Input Data Requirements

**DM Source (`raw.demographics`):**
- `subject_id`, `site_id`, `ref_start_date` (required)
- `sex`, `race`, `ethnicity` (required for CT)
- `birth_date` or `age_value` (for age calculation)
- `planned_arm_code`, `planned_arm_desc` (treatment arms)
- Additional columns as needed (see documentation)

**AE Source (`raw.adverse_events`):**
- `subject_id`, `ae_id`, `ae_term_verbatim`, `ae_start_date` (required)
- `severity`, `serious_flag`, `causality`, `outcome` (for CT mapping)
- `sae_*` flags for serious events
- MedDRA coding columns (optional, defaults to verbatim if missing)

---

## üîß Customization Guide

### Change USUBJID Pattern
Default: `STUDYID-SITEID-SUBJID`

To add screening number:
```sas
/* In dm_transform.sas, line ~153 */
USUBJID = catx('-', STUDYID, strip(site_id), strip(screen_num), SUBJID);
```

### Add Custom Variables
Example: Add RFPENDTC (End of Participation Date):
```sas
/* Step 1: Add to LENGTH statement */
RFPENDTC  $20

/* Step 2: Add transformation logic */
%iso8601_date(end_participation_date);
RFPENDTC = end_participation_date_dtc;

/* Step 3: Add to RETAIN statement */
retain ... RFPENDTC ...;
```

### Modify Controlled Terminology
Example: Source uses numeric sex codes (1=Male, 2=Female):
```sas
/* Update $sex_fmt format */
value $sex_fmt
    'M', 'MALE', '1'      = 'M'
    'F', 'FEMALE', '2'    = 'F'
    'U', 'UNKNOWN'        = 'U'
    other                 = 'U';
```

---

## üéì Controlled Terminology Reference

### DM Domain
| Variable | Valid Values |
|----------|--------------|
| **SEX** | M, F, U, UNDIFFERENTIATED |
| **AGEU** | YEARS, MONTHS, WEEKS, DAYS, HOURS |
| **RACE** | AMERICAN INDIAN OR ALASKA NATIVE, ASIAN, BLACK OR AFRICAN AMERICAN, NATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER, WHITE, MULTIPLE, OTHER, UNKNOWN, NOT REPORTED |
| **ETHNIC** | HISPANIC OR LATINO, NOT HISPANIC OR LATINO, NOT REPORTED, UNKNOWN |
| **COUNTRY** | USA, CAN, GBR, etc. (ISO 3166-1 alpha-3) |

### AE Domain
| Variable | Valid Values |
|----------|--------------|
| **AESEV** | MILD, MODERATE, SEVERE |
| **AESER** | Y, N |
| **AEACN** | DOSE INCREASED, DOSE NOT CHANGED, DOSE REDUCED, DOSE RATE REDUCED, DRUG INTERRUPTED, DRUG WITHDRAWN, NOT APPLICABLE, UNKNOWN |
| **AEREL** | NOT RELATED, UNLIKELY RELATED, POSSIBLY RELATED, PROBABLY RELATED, RELATED |
| **AEOUT** | FATAL, NOT RECOVERED/NOT RESOLVED, RECOVERED/RESOLVED, RECOVERED/RESOLVED WITH SEQUELAE, RECOVERING/RESOLVING, UNKNOWN |

---

## ‚ùì Troubleshooting

### "USUBJID has missing values"
**Cause:** Missing SITEID or SUBJID in source  
**Fix:** Check for nulls:
```sas
proc freq data=raw.demographics;
    tables site_id subject_id / missing;
run;
```

### "Duplicate USUBJID detected"
**Cause:** Multiple records for same subject  
**Fix:** Review duplicates:
```sas
proc sort data=work.dm_source nodupkey dupout=work.dupes;
    by subject_id;
run;
proc print data=work.dupes;
run;
```

### "Invalid SEX values"
**Cause:** Source uses different coding  
**Fix:** Update $sex_fmt format (see Customization section)

### "AE program fails - sdtm.dm not found"
**Cause:** DM must be created first  
**Fix:** Run DM transformation before AE

### "RFSTDTC missing, cannot calculate AESTDY"
**Cause:** Reference start date not defined  
**Fix:** Add logic to populate RFSTDTC in DM program

---

## ‚úÖ Validation Checklist

### Before Finalizing DM
- [ ] One record per subject
- [ ] All required variables populated
- [ ] Dates in ISO 8601 format (YYYY-MM-DD)
- [ ] SEX, RACE, ETHNIC use CDISC CT
- [ ] USUBJID = STUDYID-SITEID-SUBJID
- [ ] XPT file generated successfully

### Before Finalizing AE
- [ ] AESEQ unique within USUBJID
- [ ] All USUBJID exist in DM
- [ ] AETERM and AEDECOD populated
- [ ] Study days (AESTDY, AEENDY) calculated
- [ ] AESEV uses MILD/MODERATE/SEVERE
- [ ] AESER='Y' when SAE criteria met
- [ ] XPT file generated successfully

---

## üöÄ FDA Submission Readiness

### XPT File Specifications
- **Format:** SAS XPORT Version 5
- **Naming:** Lowercase domain code (dm.xpt, ae.xpt)
- **Variables:** ‚â§8 chars, uppercase
- **Labels:** ‚â§40 chars
- **Character vars:** ‚â§200 chars

### Pinnacle 21 Validation Steps
1. Open Pinnacle 21 Community
2. Select **SDTM Validation**
3. Load `dm.xpt` and `ae.xpt`
4. Run validation report
5. Review errors/warnings
6. Correct and re-run

---

## üìö Additional Resources

- [CDISC SDTM-IG v3.4](https://www.cdisc.org/standards/foundational/sdtmig)
- [CDISC Controlled Terminology](https://www.cdisc.org/standards/terminology)
- [Pinnacle 21 Community](https://www.pinnacle21.com/products/community)
- [FDA Study Data Standards](https://www.fda.gov/industry/study-data-standards-resources)

---

## üìù License & Disclaimer

**Generated for demonstration and reference purposes.**

Users should:
- Validate programs against their specific data
- Test thoroughly before production use
- Ensure compliance with organizational SOPs
- Obtain regulatory approvals before submission

**No warranty provided.** Users assume all responsibility for validation and use.

---

**END OF DOCUMENTATION**